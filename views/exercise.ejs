<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Esercizi Interattivi</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- SortableJS per il drag and drop -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/styles/exercise.css">
    <link rel="stylesheet" href="/styles/navbar.css">
</head>
<body>
<!-- Include navbar -->
<%- include('partials/navbar') %>

<div class="container mt-4">
    <!-- Header principale -->
    <div class="text-center mb-4">
        <h1 class="display-4 text-primary" id="pageTitle">
            <i class="fas fa-graduation-cap me-3"></i>
            Esercizi Interattivi
        </h1>
    </div>

    <!-- Controlli superiori -->
    <div class="controls-section mb-4">
        <div class="row">
            <div class="col-md-6">
                <div class="d-flex gap-2">
                    <button class="btn btn-outline-primary" onclick="goBack()">
                        <i class="fas fa-arrow-left me-2"></i>
                        Torna alla Home
                    </button>
                    <button class="btn btn-info" onclick="showExerciseStats()">
                        <i class="fas fa-chart-bar me-2"></i>
                        Statistiche
                    </button>
                </div>
            </div>
            <div class="col-md-6">
                <div class="d-flex gap-2 justify-content-md-end">
                    <button class="btn btn-warning" onclick="resetAllAnswers()">
                        <i class="fas fa-redo me-2"></i>
                        Reset Risposte
                    </button>
                    <button class="btn btn-success" onclick="openExamModal()">
                        <i class="fas fa-play-circle me-2"></i>
                        Modalità Esame
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Barra di progresso (nascosta inizialmente) -->
    <div id="progressContainer" class="progress-container mb-4" style="display: none;">
        <div class="d-flex justify-content-between mb-2">
            <span class="text-muted">Progresso esame</span>
            <span class="text-muted">
                    <span id="currentQuestion">0</span>/<span id="totalQuestions">0</span>
                </span>
        </div>
        <div class="progress">
            <div class="progress-bar" role="progressbar" style="width: 0%"
                 aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
    </div>

    <!-- Timer (nascosto inizialmente) -->
    <div id="timerContainer" class="text-center mb-4" style="display: none;">
        <div class="alert alert-warning d-inline-block">
            <i class="fas fa-clock me-2"></i>
            <strong>Tempo rimanente: <span id="timeRemaining">00:00</span></strong>
        </div>
    </div>

    <!-- Loading message -->
    <div id="noDataMessage" class="text-center py-5">
        <div class="alert alert-info">
            <i class="fas fa-info-circle fa-2x mb-3 d-block"></i>
            <h4>Nessun esercizio caricato</h4>
            <p class="mb-3">Per iniziare, torna alla homepage e carica un file JSON o crea nuovi esercizi.</p>
            <button class="btn btn-primary" onclick="goBack()">
                <i class="fas fa-home me-2"></i>
                Vai alla Homepage
            </button>
        </div>
    </div>

    <!-- Contenitore esercizi -->
    <div id="exercise-content">
        <!-- Gli esercizi verranno inseriti qui dinamicamente -->
    </div>

    <!-- Pulsanti di navigazione per modalità esame -->
    <div id="examNavigation" class="d-flex justify-content-between mt-4" style="display: none;">
        <button class="btn btn-outline-secondary" onclick="previousExercise()" disabled>
            <i class="fas fa-chevron-left me-2"></i>
            Precedente
        </button>
        <div class="exam-info">
                <span class="badge bg-primary fs-6 py-2 px-3">
                    Domanda <span id="currentQuestionNav">1</span> di <span id="totalQuestionsNav">10</span>
                </span>
        </div>
        <button class="btn btn-outline-primary" onclick="nextExercise()">
            Successiva
            <i class="fas fa-chevron-right ms-2"></i>
        </button>
    </div>

    <!-- Pulsante fine esame -->
    <div id="finishExam" class="text-center mt-4" style="display: none;">
        <button class="btn btn-danger btn-lg" onclick="finishExam()">
            <i class="fas fa-flag-checkered me-2"></i>
            Termina Esame
        </button>
    </div>
</div>

<!-- Modal Configurazione Esame -->
<div class="modal fade" id="examModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">
                    <i class="fas fa-cog me-2"></i>
                    Configura Modalità Esame
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="examConfigForm">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="numQuestions" class="form-label">
                                    <i class="fas fa-list-ol me-2"></i>
                                    Numero di esercizi
                                </label>
                                <input type="number" class="form-control" id="numQuestions"
                                       min="1" max="100" value="10">
                                <div class="form-text">Massimo disponibili: <span id="maxAvailable">0</span></div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="examTime" class="form-label">
                                    <i class="fas fa-clock me-2"></i>
                                    Tempo (minuti)
                                </label>
                                <input type="number" class="form-control" id="examTime"
                                       min="0" max="240" value="30">
                                <div class="form-text">0 = tempo illimitato</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="difficulty" class="form-label">
                                    <i class="fas fa-signal me-2"></i>
                                    Difficoltà
                                </label>
                                <select class="form-select" id="difficulty">
                                    <option value="all">Tutte le difficoltà</option>
                                    <option value="facile">Solo Facili</option>
                                    <option value="medio">Solo Medie</option>
                                    <option value="difficile">Solo Difficili</option>
                                    <option value="mixed">Mix Bilanciato</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12">
                            <div class="mb-3">
                                <label class="form-label">
                                    <i class="fas fa-tasks me-2"></i>
                                    Tipi di esercizi da includere
                                </label>
                                <div id="exerciseTypesContainer" class="row">
                                    <!-- I checkboxes verranno generati dinamicamente -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="randomizeQuestions" checked>
                                <label class="form-check-label" for="randomizeQuestions">
                                    Randomizza ordine domande
                                </label>
                            </div>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="showExplanations" checked>
                                <label class="form-check-label" for="showExplanations">
                                    Mostra spiegazioni dopo le risposte
                                </label>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annulla</button>
                <button type="button" class="btn btn-success btn-lg" onclick="startCustomExam()">
                    <i class="fas fa-rocket me-2"></i>
                    Avvia Esame
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Risultati -->
<div class="modal fade" id="resultsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title">
                    <i class="fas fa-trophy me-2"></i>
                    Risultati Esame
                </h5>
            </div>
            <div class="modal-body" id="resultsContent">
                <!-- Contenuto risultati generato dinamicamente -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Chiudi</button>
                <button type="button" class="btn btn-primary" onclick="retakeExam()">
                    <i class="fas fa-redo me-2"></i>
                    Ripeti Esame
                </button>
                <button type="button" class="btn btn-success" onclick="downloadResults()">
                    <i class="fas fa-download me-2"></i>
                    Scarica Risultati
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Statistiche -->
<div class="modal fade" id="statisticsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title">
                    <i class="fas fa-chart-bar me-2"></i>
                    Statistiche Esercizi
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="statisticsContent">
                <!-- Contenuto statistiche generato dinamicamente -->
            </div>
        </div>
    </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="/scripts/exercise-enhanced.js"></script>
<script src="/scripts/exercise-renderers.js"></script>
</body>
</html>